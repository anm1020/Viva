================================================================================
                    VIVA AI ë©´ì ‘ ê´€ë ¨ ì˜¤ë¥˜ ë¶„ì„ ë° í•´ê²° ë°©ì•ˆ
================================================================================

ğŸ“‹ ë‹´ë‹¹ ê¸°ëŠ¥
- AI ë©´ì ‘ ê¸°ëŠ¥ (GPT API ì—°ë™)
- ìì†Œì„œ AI í”¼ë“œë°± ê¸°ëŠ¥
- ë©´ì ‘ê´€ CRUD ê¸°ëŠ¥

================================================================================
ğŸ” 1. AI ë©´ì ‘ ê¸°ëŠ¥ ì˜¤ë¥˜ ë¶„ì„
================================================================================

### 1-1. AI ì„¸ì…˜ ê´€ë¦¬ ì˜¤ë¥˜

**1. ì˜¤ë¥˜ ì‚¬ìœ **
- ì„¸ì…˜ ID ìƒì„± ë° ê´€ë¦¬ ë¡œì§ ë³µì¡ì„±
- ì‚¬ìš©ìë³„ ì„¸ì…˜ ë¶„ë¦¬ ì‹¤íŒ¨
- ì„¸ì…˜ ë°ì´í„° ì˜ì†í™” ë¬¸ì œ

**2. ì˜¤ë¥˜ ì½”ë“œ**
```java
// AIController.java - ì„¸ì…˜ ìƒì„± ë¡œì§ ì˜¤ë¥˜
@GetMapping("/aichat")
public String chatPage(
    @RequestParam(value = "sessionId", required = false) String sessionId,
    @RequestParam(value = "new", required = false) String isNew,
    HttpSession httpSession, Principal principal, Model model) {
    
    String userId = null;
    if (principal != null) {
        userId = principal.getName();
    }

    // ë³µì¡í•œ ì„¸ì…˜ ìƒì„± ë¡œì§ìœ¼ë¡œ ì¸í•œ ì˜¤ë¥˜
    if ("1".equals(isNew) && userId != null) {
        sessionId = UUID.randomUUID().toString();
        AiSession newSession = AiSession.builder()
            .sessionId(sessionId)
            .userId(userId)
            .title("ìƒˆë¡œìš´ ëŒ€í™”")
            .createdDt(java.time.LocalDateTime.now().toString())
            .build();
        aiSessionService.saveSession(newSession);
    } else if ((sessionId == null || sessionId.isEmpty()) && userId != null) {
        // ì´ ë¶€ë¶„ì—ì„œ ì„¸ì…˜ ì¡°íšŒ ì‹¤íŒ¨ ì‹œ ì˜¤ë¥˜ ë°œìƒ
        List<AiSession> userSessions = aiSessionService.getSessionsByUserId(userId);
        if (userSessions != null && !userSessions.isEmpty()) {
            sessionId = userSessions.get(0).getSessionId();
        } else {
            // ìƒˆ ì„¸ì…˜ ìƒì„± ë¡œì§ ì¤‘ë³µ
        }
    }
}
```

**3. í•´ê²° ë°©ì•ˆ**
```java
// ê°œì„ ëœ ì„¸ì…˜ ê´€ë¦¬ ë¡œì§
@GetMapping("/aichat")
public String chatPage(
    @RequestParam(value = "sessionId", required = false) String sessionId,
    @RequestParam(value = "new", required = false) String isNew,
    Principal principal, Model model) {
    
    String userId = principal != null ? principal.getName() : null;
    
    // ì„¸ì…˜ ìƒì„± ë¡œì§ ë‹¨ìˆœí™”
    if (userId == null) {
        return "redirect:/loginmain";
    }
    
    // ìƒˆ ì„¸ì…˜ ìš”ì²­ì´ê±°ë‚˜ ì„¸ì…˜ì´ ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±
    if ("1".equals(isNew) || sessionId == null || sessionId.isEmpty()) {
        sessionId = createNewSession(userId);
    }
    
    // ì„¸ì…˜ ìœ íš¨ì„± ê²€ì¦
    if (!isValidSession(sessionId, userId)) {
        sessionId = createNewSession(userId);
    }
    
    List<AiMessage> messages = aiMessageService.getMessagesBySessionId(sessionId);
    model.addAttribute("messages", messages);
    model.addAttribute("sessionId", sessionId);
    
    return "Ai/aichat";
}

private String createNewSession(String userId) {
    String sessionId = UUID.randomUUID().toString();
    AiSession newSession = AiSession.builder()
        .sessionId(sessionId)
        .userId(userId)
        .title("ìƒˆë¡œìš´ ëŒ€í™”")
        .createdDt(LocalDateTime.now().toString())
        .build();
    aiSessionService.saveSession(newSession);
    return sessionId;
}

private boolean isValidSession(String sessionId, String userId) {
    return aiSessionService.findById(sessionId)
        .map(session -> userId.equals(session.getUserId()))
        .orElse(false);
}
```

**4. ê²°ë¡ **
- ì„¸ì…˜ ìƒì„± ë¡œì§ì„ ë³„ë„ ë©”ì„œë“œë¡œ ë¶„ë¦¬í•˜ì—¬ ë³µì¡ì„± ê°ì†Œ
- ì„¸ì…˜ ìœ íš¨ì„± ê²€ì¦ ë¡œì§ ì¶”ê°€ë¡œ ë³´ì•ˆ ê°•í™”
- ì‚¬ìš©ìë³„ ì„¸ì…˜ ë¶„ë¦¬ ëª…í™•í™”

### 1-2. AI ë©”ì‹œì§€ ì „ì†¡ ë° ì‘ë‹µ ì˜¤ë¥˜

**1. ì˜¤ë¥˜ ì‚¬ìœ **
- GPT API í˜¸ì¶œ ì‹œ ì˜ˆì™¸ ì²˜ë¦¬ ë¯¸í¡
- ë©”ì‹œì§€ ì €ì¥ê³¼ API ì‘ë‹µ ì²˜ë¦¬ ìˆœì„œ ë¬¸ì œ
- null ì²´í¬ ë¶€ì¡±ìœ¼ë¡œ ì¸í•œ NullPointerException

**2. ì˜¤ë¥˜ ì½”ë“œ**
```java
// AiMessageServiceImpl.java - ë©”ì‹œì§€ ì²˜ë¦¬ ì˜¤ë¥˜
@Override
public Map<String, AiMessage> sendAndReply(String sessionId, String prompt) {
    // 1. ì‚¬ìš©ì ë©”ì‹œì§€ ì €ì¥
    AiMessage userMessage = saveMessage(AiMessage.builder()
        .sessionId(sessionId)
        .role("user")
        .content(prompt)
        .createdDt(LocalDateTime.now().toString())
        .build());

    // 2. GPT API í˜¸ì¶œ - ì—¬ê¸°ì„œ ì˜¤ë¥˜ ë°œìƒ ê°€ëŠ¥
    String response = aiService.askChatGPT(prompt);

    // 3. GPT ì‘ë‹µ ì €ì¥
    AiMessage assistantMessage = saveMessage(AiMessage.builder()
        .sessionId(sessionId)
        .role("assistant")
        .content(response)
        .createdDt(LocalDateTime.now().toString())
        .build());

    // 4. ë©”ì‹œì§€ 6ê°œ ì´ìƒì¼ ê²½ìš° ìë™ ìš”ì•½
    List<AiMessage> allMessages = getMessagesBySessionId(sessionId);
    if (allMessages.size() >= 6) {
        try {
            String summary = aiService.summarizeMessages(allMessages);
            aiSessionService.updateSummary(sessionId, summary);
        } catch (Exception e) {
            System.err.println("ìš”ì•½ ìƒì„± ì¤‘ ì˜¤ë¥˜: " + e.getMessage());
            e.printStackTrace();
        }
    }

    return Map.of(
        "userMessage", userMessage,
        "assistantMessage", assistantMessage
    );
}
```

**3. í•´ê²° ë°©ì•ˆ**
```java
// ê°œì„ ëœ ë©”ì‹œì§€ ì²˜ë¦¬ ë¡œì§
@Override
public Map<String, AiMessage> sendAndReply(String sessionId, String prompt) {
    try {
        // ì„¸ì…˜ ìœ íš¨ì„± ê²€ì¦
        if (sessionId == null || sessionId.trim().isEmpty()) {
            throw new IllegalArgumentException("ì„¸ì…˜ IDê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        }
        
        // 1. ì‚¬ìš©ì ë©”ì‹œì§€ ì €ì¥
        AiMessage userMessage = saveMessage(AiMessage.builder()
            .sessionId(sessionId)
            .role("user")
            .content(prompt)
            .createdDt(LocalDateTime.now().toString())
            .build());

        // 2. GPT API í˜¸ì¶œ (ì˜ˆì™¸ ì²˜ë¦¬ ê°•í™”)
        String response;
        try {
            response = aiService.askChatGPT(prompt);
            if (response == null || response.trim().isEmpty()) {
                response = "ì£„ì†¡í•©ë‹ˆë‹¤. ì‘ë‹µì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
            }
        } catch (Exception e) {
            System.err.println("GPT API í˜¸ì¶œ ì˜¤ë¥˜: " + e.getMessage());
            response = "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
        }

        // 3. GPT ì‘ë‹µ ì €ì¥
        AiMessage assistantMessage = saveMessage(AiMessage.builder()
            .sessionId(sessionId)
            .role("assistant")
            .content(response)
            .createdDt(LocalDateTime.now().toString())
            .build());

        // 4. ìë™ ìš”ì•½ (ë³„ë„ ìŠ¤ë ˆë“œë¡œ ì²˜ë¦¬)
        scheduleSummaryGeneration(sessionId);

        return Map.of(
            "userMessage", userMessage,
            "assistantMessage", assistantMessage
        );
        
    } catch (Exception e) {
        System.err.println("ë©”ì‹œì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜: " + e.getMessage());
        e.printStackTrace();
        
        // ì˜¤ë¥˜ ì‘ë‹µ ìƒì„±
        AiMessage errorMessage = AiMessage.builder()
            .sessionId(sessionId)
            .role("assistant")
            .content("ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")
            .createdDt(LocalDateTime.now().toString())
            .build();
            
        return Map.of(
            "userMessage", new AiMessage(),
            "assistantMessage", errorMessage
        );
    }
}

private void scheduleSummaryGeneration(String sessionId) {
    // ë¹„ë™ê¸°ë¡œ ìš”ì•½ ìƒì„± (ì„±ëŠ¥ ê°œì„ )
    CompletableFuture.runAsync(() -> {
        try {
            List<AiMessage> allMessages = getMessagesBySessionId(sessionId);
            if (allMessages.size() >= 6) {
                String summary = aiService.summarizeMessages(allMessages);
                aiSessionService.updateSummary(sessionId, summary);
            }
        } catch (Exception e) {
            System.err.println("ìš”ì•½ ìƒì„± ì¤‘ ì˜¤ë¥˜: " + e.getMessage());
        }
    });
}
```

**4. ê²°ë¡ **
- GPT API í˜¸ì¶œ ì‹œ ì˜ˆì™¸ ì²˜ë¦¬ ê°•í™”
- null ì²´í¬ ë° ìœ íš¨ì„± ê²€ì¦ ì¶”ê°€
- ë¹„ë™ê¸° ì²˜ë¦¬ë¡œ ì„±ëŠ¥ ê°œì„ 
- ì˜¤ë¥˜ ë°œìƒ ì‹œì—ë„ ì‚¬ìš©ìì—ê²Œ ì ì ˆí•œ ì‘ë‹µ ì œê³µ

### 1-3. AI ì„¸ì…˜ ì‚­ì œ ë° ì—…ë°ì´íŠ¸ ì˜¤ë¥˜

**1. ì˜¤ë¥˜ ì‚¬ìœ **
- ì„¸ì…˜ ì‚­ì œ ì‹œ ì—°ê´€ëœ ë©”ì‹œì§€ ì‚­ì œ ì‹¤íŒ¨
- ì„¸ì…˜ ì œëª© ì—…ë°ì´íŠ¸ ì‹œ ë™ì‹œì„± ë¬¸ì œ
- ì‚­ì œ ê¶Œí•œ ê²€ì¦ ëˆ„ë½

**2. ì˜¤ë¥˜ ì½”ë“œ**
```java
// AIController.java - ì„¸ì…˜ ì‚­ì œ ì˜¤ë¥˜
@DeleteMapping("/session/delete")
public ResponseEntity<?> deleteSession(@RequestParam("sessionId") String sessionId) {
    aiSessionService.deleteSessionById(sessionId);
    aiMessageService.deleteMessagesBySessionId(sessionId);
    return ResponseEntity.ok().build();
}

// ì„¸ì…˜ ì œëª© ì—…ë°ì´íŠ¸ ì˜¤ë¥˜
@PostMapping("/session/updateTitle")
public ResponseEntity<?> updateSessionTitle(@RequestBody Map<String, String> req) {
    String sessionId = req.get("sessionId");
    String title = req.get("title");
    aiSessionService.updateSessionTitle(sessionId, title);
    return ResponseEntity.ok().build();
}
```

**3. í•´ê²° ë°©ì•ˆ**
```java
// ê°œì„ ëœ ì„¸ì…˜ ê´€ë¦¬
@DeleteMapping("/session/delete")
public ResponseEntity<?> deleteSession(
    @RequestParam("sessionId") String sessionId,
    Principal principal) {
    
    try {
        String userId = principal.getName();
        
        // ê¶Œí•œ ê²€ì¦
        if (!hasSessionPermission(sessionId, userId)) {
            return ResponseEntity.status(403).body("ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");
        }
        
        // íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì•ˆì „í•œ ì‚­ì œ
        deleteSessionWithMessages(sessionId);
        
        return ResponseEntity.ok().build();
        
    } catch (Exception e) {
        System.err.println("ì„¸ì…˜ ì‚­ì œ ì˜¤ë¥˜: " + e.getMessage());
        return ResponseEntity.status(500).body("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }
}

@PostMapping("/session/updateTitle")
public ResponseEntity<?> updateSessionTitle(
    @RequestBody Map<String, String> req,
    Principal principal) {
    
    try {
        String sessionId = req.get("sessionId");
        String title = req.get("title");
        String userId = principal.getName();
        
        // ì…ë ¥ê°’ ê²€ì¦
        if (sessionId == null || title == null || title.trim().isEmpty()) {
            return ResponseEntity.badRequest().body("ì˜ëª»ëœ ìš”ì²­ì…ë‹ˆë‹¤.");
        }
        
        // ê¶Œí•œ ê²€ì¦
        if (!hasSessionPermission(sessionId, userId)) {
            return ResponseEntity.status(403).body("ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");
        }
        
        // ì œëª© ì—…ë°ì´íŠ¸
        aiSessionService.updateSessionTitle(sessionId, title.trim());
        
        return ResponseEntity.ok().build();
        
    } catch (Exception e) {
        System.err.println("ì œëª© ì—…ë°ì´íŠ¸ ì˜¤ë¥˜: " + e.getMessage());
        return ResponseEntity.status(500).body("ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }
}

@Transactional
private void deleteSessionWithMessages(String sessionId) {
    // ë©”ì‹œì§€ ë¨¼ì € ì‚­ì œ
    aiMessageService.deleteMessagesBySessionId(sessionId);
    // ì„¸ì…˜ ì‚­ì œ
    aiSessionService.deleteSessionById(sessionId);
}

private boolean hasSessionPermission(String sessionId, String userId) {
    return aiSessionService.findById(sessionId)
        .map(session -> userId.equals(session.getUserId()))
        .orElse(false);
}
```

**4. ê²°ë¡ **
- ê¶Œí•œ ê²€ì¦ ë¡œì§ ì¶”ê°€ë¡œ ë³´ì•ˆ ê°•í™”
- íŠ¸ëœì­ì…˜ ì‚¬ìš©ìœ¼ë¡œ ë°ì´í„° ì¼ê´€ì„± ë³´ì¥
- ì…ë ¥ê°’ ê²€ì¦ìœ¼ë¡œ ì•ˆì •ì„± í–¥ìƒ

================================================================================
ğŸ” 2. ìì†Œì„œ AI í”¼ë“œë°± ê¸°ëŠ¥ ì˜¤ë¥˜ ë¶„ì„
================================================================================

### 2-1. AI í”¼ë“œë°± ìƒì„± ì˜¤ë¥˜

**1. ì˜¤ë¥˜ ì‚¬ìœ **
- ìì†Œì„œ í…ìŠ¤íŠ¸ê°€ ë„ˆë¬´ ê¸¸ì–´ì„œ GPT API í† í° ì œí•œ ì´ˆê³¼
- ìì†Œì„œ ì„¹ì…˜ë³„ ë¶„ë¦¬ ì²˜ë¦¬ ë³µì¡ì„±
- AI ì‘ë‹µ íŒŒì‹± ì˜¤ë¥˜

**2. ì˜¤ë¥˜ ì½”ë“œ**
```java
// JasoController.java - AI í”¼ë“œë°± ìƒì„± ì˜¤ë¥˜
@PostMapping("/{id}/generate-feedback")
public String generateFeedback(@PathVariable("id") Long id, RedirectAttributes redirectAttributes) {
    try {
        Jaso jaso = jasoService.getJasoById(id);
        if (jaso == null) {
            redirectAttributes.addFlashAttribute("error", "ìì†Œì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            return "redirect:/mypage/jaso/list";
        }

        // AI í”¼ë“œë°± ìƒì„± - ì—¬ê¸°ì„œ í† í° ì œí•œ ì˜¤ë¥˜ ë°œìƒ
        String feedback = aiService.generateJasoFeedback(jaso);
        
        JasoFeedback newFeedback = new JasoFeedback();
        newFeedback.setJasoId(id);
        newFeedback.setFeedback(feedback);
        newFeedback.setCreatedDt(LocalDateTime.now().format(DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss")));
        
        jasofeedbackService.saveFeedback(newFeedback);
        redirectAttributes.addFlashAttribute("message", "AI í”¼ë“œë°±ì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.");
    } catch (Exception e) {
        redirectAttributes.addFlashAttribute("error", "AI í”¼ë“œë°± ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        e.printStackTrace();
    }
    return "redirect:/mypage/jaso/view/" + id;
}
```

**3. í•´ê²° ë°©ì•ˆ**
```java
// ê°œì„ ëœ AI í”¼ë“œë°± ìƒì„±
@PostMapping("/{id}/generate-feedback")
public String generateFeedback(@PathVariable("id") Long id, RedirectAttributes redirectAttributes) {
    try {
        Jaso jaso = jasoService.getJasoById(id);
        if (jaso == null) {
            redirectAttributes.addFlashAttribute("error", "ìì†Œì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            return "redirect:/mypage/jaso/list";
        }

        // ìì†Œì„œ í…ìŠ¤íŠ¸ ê¸¸ì´ ì²´í¬ ë° ë¶„í• 
        String feedback = generateFeedbackBySections(jaso);
        
        JasoFeedback newFeedback = new JasoFeedback();
        newFeedback.setJasoId(id);
        newFeedback.setFeedback(feedback);
        newFeedback.setCreatedDt(LocalDateTime.now().format(DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss")));
        
        jasofeedbackService.saveFeedback(newFeedback);
        redirectAttributes.addFlashAttribute("message", "AI í”¼ë“œë°±ì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.");
        
    } catch (Exception e) {
        redirectAttributes.addFlashAttribute("error", "AI í”¼ë“œë°± ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + e.getMessage());
        e.printStackTrace();
    }
    return "redirect:/mypage/jaso/view/" + id;
}

private String generateFeedbackBySections(Jaso jaso) {
    StringBuilder feedback = new StringBuilder();
    
    // ì„¹ì…˜ë³„ë¡œ í”¼ë“œë°± ìƒì„±
    Map<String, String> sections = Map.of(
        "ì„±ì¥ê³¼ì •", jaso.getGrowth(),
        "ì„±ê²©ì˜ ì¥ë‹¨ì ", jaso.getPersonality(),
        "í•™ì°½ì‹œì ˆ ë° ë™ì•„ë¦¬í™œë™", jaso.getSchool(),
        "ì§€ì›ë™ê¸°", jaso.getMotivation(),
        "ì…ì‚¬ í›„ í¬ë¶€", jaso.getFuture(),
        "ê¸°íƒ€ íŠ¹ë³„í•œ ê²½í—˜", jaso.getExperience()
    );
    
    for (Map.Entry<String, String> entry : sections.entrySet()) {
        String sectionName = entry.getKey();
        String content = entry.getValue();
        
        if (content != null && !content.trim().isEmpty()) {
            try {
                String sectionFeedback = generateSectionFeedback(sectionName, content);
                feedback.append("ã€").append(sectionName).append("ã€‘\n");
                feedback.append(sectionFeedback).append("\n\n");
            } catch (Exception e) {
                System.err.println(sectionName + " í”¼ë“œë°± ìƒì„± ì˜¤ë¥˜: " + e.getMessage());
                feedback.append("ã€").append(sectionName).append("ã€‘\n");
                feedback.append("ì´ ì„¹ì…˜ì˜ í”¼ë“œë°±ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\n");
            }
        }
    }
    
    return feedback.toString();
}

private String generateSectionFeedback(String sectionName, String content) {
    // í† í° ì œí•œì„ ê³ ë ¤í•œ í”„ë¡¬í”„íŠ¸ ìƒì„±
    String prompt = String.format(
        "ë‹¤ìŒ ìì†Œì„œì˜ '%s' ì„¹ì…˜ì— ëŒ€í•œ êµ¬ì²´ì ì¸ í”¼ë“œë°±ì„ ì œê³µí•´ì£¼ì„¸ìš”. " +
        "ê°œì„ ì , ê°•ì , ì¶”ê°€ ì œì•ˆì‚¬í•­ì„ í¬í•¨í•´ì„œ 200ì ì´ë‚´ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”.\n\n" +
        "ë‚´ìš©: %s", sectionName, content
    );
    
    return aiService.askChatGPT(prompt);
}
```

**4. ê²°ë¡ **
- ì„¹ì…˜ë³„ ë¶„í•  ì²˜ë¦¬ë¡œ í† í° ì œí•œ ë¬¸ì œ í•´ê²°
- ê° ì„¹ì…˜ë³„ ë…ë¦½ì ì¸ í”¼ë“œë°± ìƒì„±ìœ¼ë¡œ ì•ˆì •ì„± í–¥ìƒ
- ì˜¤ë¥˜ ë°œìƒ ì‹œì—ë„ ë‹¤ë¥¸ ì„¹ì…˜ í”¼ë“œë°±ì€ ì •ìƒ ìƒì„±

### 2-2. ìì†Œì„œ ì„¹ì…˜ íŒŒì‹± ì˜¤ë¥˜

**1. ì˜¤ë¥˜ ì‚¬ìœ **
- ìì†Œì„œ content í•„ë“œ ì œê±° í›„ ì„¹ì…˜ë³„ í•„ë“œ ë§¤í•‘ ì˜¤ë¥˜
- null ê°’ ì²˜ë¦¬ ë¯¸í¡
- ì„¹ì…˜ë³„ ë°ì´í„° ë¶„ë¦¬ ë¡œì§ ë³µì¡ì„±

**2. ì˜¤ë¥˜ ì½”ë“œ**
```java
// JasoController.java - ìì†Œì„œ ìƒì„¸ ì¡°íšŒ ì˜¤ë¥˜
@GetMapping("/view/{id}")
public String viewJaso(@PathVariable("id") Long id, Model model) {
    Jaso jaso = jasoService.getJasoById(id);
    if (jaso == null) {
        return "redirect:/mypage/jaso/list?error=not_found";
    }

    // ì„¹ì…˜ë³„ ë¶„ë¦¬ - ì—¬ê¸°ì„œ null ì˜¤ë¥˜ ë°œìƒ ê°€ëŠ¥
    Map<String, String> sectionMap = new LinkedHashMap<>();
    sectionMap.put("ì„±ì¥ê³¼ì •", jaso.getGrowth());
    sectionMap.put("ì„±ê²©ì˜ ì¥ë‹¨ì ", jaso.getPersonality());
    sectionMap.put("í•™ì°½ì‹œì ˆ ë° ë™ì•„ë¦¬í™œë™", jaso.getSchool());
    sectionMap.put("ì§€ì›ë™ê¸°", jaso.getMotivation());
    sectionMap.put("ì…ì‚¬ í›„ í¬ë¶€", jaso.getFuture());
    sectionMap.put("ê¸°íƒ€ íŠ¹ë³„í•œ ê²½í—˜", jaso.getExperience());
    model.addAttribute("sectionMap", sectionMap);

    List<JasoFeedback> feedbackList = jasofeedbackService.getFeedbackByJasoId(id);
    model.addAttribute("jaso", jaso);
    model.addAttribute("feedbackList", feedbackList);
    return "mypage/jasoview";
}
```

**3. í•´ê²° ë°©ì•ˆ**
```java
// ê°œì„ ëœ ìì†Œì„œ ìƒì„¸ ì¡°íšŒ
@GetMapping("/view/{id}")
public String viewJaso(@PathVariable("id") Long id, Model model) {
    try {
        Jaso jaso = jasoService.getJasoById(id);
        if (jaso == null) {
            return "redirect:/mypage/jaso/list?error=not_found";
        }

        // ì•ˆì „í•œ ì„¹ì…˜ë³„ ë¶„ë¦¬
        Map<String, String> sectionMap = new LinkedHashMap<>();
        sectionMap.put("ì„±ì¥ê³¼ì •", getSafeContent(jaso.getGrowth()));
        sectionMap.put("ì„±ê²©ì˜ ì¥ë‹¨ì ", getSafeContent(jaso.getPersonality()));
        sectionMap.put("í•™ì°½ì‹œì ˆ ë° ë™ì•„ë¦¬í™œë™", getSafeContent(jaso.getSchool()));
        sectionMap.put("ì§€ì›ë™ê¸°", getSafeContent(jaso.getMotivation()));
        sectionMap.put("ì…ì‚¬ í›„ í¬ë¶€", getSafeContent(jaso.getFuture()));
        sectionMap.put("ê¸°íƒ€ íŠ¹ë³„í•œ ê²½í—˜", getSafeContent(jaso.getExperience()));
        
        // ë¹ˆ ì„¹ì…˜ í•„í„°ë§
        Map<String, String> nonEmptySections = sectionMap.entrySet().stream()
            .filter(entry -> entry.getValue() != null && !entry.getValue().trim().isEmpty())
            .collect(Collectors.toMap(
                Map.Entry::getKey,
                Map.Entry::getValue,
                (e1, e2) -> e1,
                LinkedHashMap::new
            ));
        
        model.addAttribute("sectionMap", nonEmptySections);
        model.addAttribute("jaso", jaso);
        
        // í”¼ë“œë°± ëª©ë¡ ì¡°íšŒ
        List<JasoFeedback> feedbackList = jasofeedbackService.getFeedbackByJasoId(id);
        model.addAttribute("feedbackList", feedbackList != null ? feedbackList : List.of());
        
        return "mypage/jasoview";
        
    } catch (Exception e) {
        System.err.println("ìì†Œì„œ ìƒì„¸ ì¡°íšŒ ì˜¤ë¥˜: " + e.getMessage());
        return "redirect:/mypage/jaso/list?error=system";
    }
}

private String getSafeContent(String content) {
    return content != null ? content.trim() : "";
}
```

**4. ê²°ë¡ **
- null ì²´í¬ ë° ì•ˆì „í•œ ë¬¸ìì—´ ì²˜ë¦¬
- ë¹ˆ ì„¹ì…˜ í•„í„°ë§ìœ¼ë¡œ UI ê°œì„ 
- ì˜ˆì™¸ ì²˜ë¦¬ë¡œ ì‹œìŠ¤í…œ ì•ˆì •ì„± í–¥ìƒ

================================================================================
ğŸ” 3. ë©´ì ‘ê´€ CRUD ê¸°ëŠ¥ ì˜¤ë¥˜ ë¶„ì„
================================================================================

### 3-1. ë©´ì ‘ê´€ ë“±ë¡ ê¶Œí•œ ê²€ì¦ ì˜¤ë¥˜

**1. ì˜¤ë¥˜ ì‚¬ìœ **
- ë©´ì ‘ê´€ ê¶Œí•œ ì²´í¬ ë¡œì§ ë¯¸í¡
- ì¼ë°˜ ì‚¬ìš©ìê°€ ë©´ì ‘ê´€ ë“±ë¡ í˜ì´ì§€ ì ‘ê·¼ ê°€ëŠ¥
- ê¶Œí•œ ì˜¤ë¥˜ ì‹œ ì ì ˆí•œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì²˜ë¦¬ ë¶€ì¡±

**2. ì˜¤ë¥˜ ì½”ë“œ**
```java
// InterviewerController.java - ë©´ì ‘ê´€ ë“±ë¡ ê¶Œí•œ ì˜¤ë¥˜
@GetMapping("/interviewer/form")
public String showForm(Principal principal, Model model) {
    String userId = principal.getName();
    Users user = usersRepository.findByUserId(userId);
    if (user == null || !"intr".equals(user.getUserRole())) {
        // ë©´ì ‘ê´€ì´ ì•„ë‹ˆë©´ ì ‘ê·¼ ë¶ˆê°€
        return "redirect:/interviewer?error=not_intr";
    }
    model.addAttribute("user", user);
    return "interviewer/form";
}

@PostMapping("/interviewer/save")
public String saveInterviewer(Principal principal,
                              @RequestParam(name = "intrIntro", required = false) String intrIntro,
                              @RequestParam(name = "intrImage", required = false) String intrImage,
                              @RequestParam(name = "intrPrice", required = false) Integer intrPrice,
                              @RequestParam(name = "intrCate", required = false) String intrCate,
                              @RequestParam(name = "intrContent", required = false) String intrContent) {
    String userId = principal.getName();
    Users user = usersRepository.findByUserId(userId);
    if (user == null || !"intr".equals(user.getUserRole())) {
        // ë©´ì ‘ê´€ì´ ì•„ë‹ˆë©´ ì €ì¥ ë¶ˆê°€
        return "redirect:/interviewer?error=not_intr";
    }
    // ì €ì¥ ë¡œì§...
}
```

**3. í•´ê²° ë°©ì•ˆ**
```java
// ê°œì„ ëœ ê¶Œí•œ ê²€ì¦
@GetMapping("/interviewer/form")
public String showForm(Principal principal, Model model, RedirectAttributes redirectAttributes) {
    try {
        if (principal == null) {
            redirectAttributes.addFlashAttribute("error", "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            return "redirect:/loginmain";
        }
        
        String userId = principal.getName();
        Users user = usersRepository.findByUserId(userId);
        
        if (user == null) {
            redirectAttributes.addFlashAttribute("error", "ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            return "redirect:/main";
        }
        
        if (!"intr".equals(user.getUserRole())) {
            redirectAttributes.addFlashAttribute("error", "ë©´ì ‘ê´€ë§Œ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
            return "redirect:/interviewer";
        }
        
        model.addAttribute("user", user);
        return "interviewer/form";
        
    } catch (Exception e) {
        redirectAttributes.addFlashAttribute("error", "ì‹œìŠ¤í…œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        return "redirect:/main";
    }
}

@PostMapping("/interviewer/save")
public String saveInterviewer(Principal principal,
                              @RequestParam(name = "intrIntro", required = false) String intrIntro,
                              @RequestParam(name = "intrImage", required = false) String intrImage,
                              @RequestParam(name = "intrPrice", required = false) Integer intrPrice,
                              @RequestParam(name = "intrCate", required = false) String intrCate,
                              @RequestParam(name = "intrContent", required = false) String intrContent,
                              RedirectAttributes redirectAttributes) {
    try {
        if (principal == null) {
            redirectAttributes.addFlashAttribute("error", "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            return "redirect:/loginmain";
        }
        
        String userId = principal.getName();
        Users user = usersRepository.findByUserId(userId);
        
        if (user == null || !"intr".equals(user.getUserRole())) {
            redirectAttributes.addFlashAttribute("error", "ë©´ì ‘ê´€ë§Œ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
            return "redirect:/interviewer";
        }
        
        // ì…ë ¥ê°’ ê²€ì¦
        if (intrIntro == null || intrIntro.trim().isEmpty()) {
            redirectAttributes.addFlashAttribute("error", "ìê¸°ì†Œê°œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return "redirect:/interviewer/form";
        }
        
        // ë©´ì ‘ê´€ ì •ë³´ ì €ì¥
        Interviewer interviewer = new Interviewer();
        interviewer.setUserId(userId);
        interviewer.setIntrIntro(intrIntro.trim());
        interviewer.setIntrImage(intrImage != null ? intrImage.trim() : "");
        interviewer.setIntrPrice(intrPrice != null ? intrPrice : 0);
        interviewer.setIntrCate(intrCate != null ? intrCate.trim() : "");
        interviewer.setIntrContent(intrContent != null ? intrContent.trim() : "");
        
        interviewerService.save(interviewer);
        
        redirectAttributes.addFlashAttribute("message", "ë©´ì ‘ê´€ ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
        return "redirect:/interviewer";
        
    } catch (Exception e) {
        redirectAttributes.addFlashAttribute("error", "ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + e.getMessage());
        return "redirect:/interviewer/form";
    }
}
```

**4. ê²°ë¡ **
- ìƒì„¸í•œ ê¶Œí•œ ê²€ì¦ ë¡œì§ êµ¬í˜„
- ì…ë ¥ê°’ ê²€ì¦ ë° ì•ˆì „í•œ ë¬¸ìì—´ ì²˜ë¦¬
- ì ì ˆí•œ ì˜¤ë¥˜ ë©”ì‹œì§€ì™€ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì²˜ë¦¬

### 3-2. ë©´ì ‘ê´€ ëª©ë¡ ì¡°íšŒ ë° ê²€ìƒ‰ ì˜¤ë¥˜

**1. ì˜¤ë¥˜ ì‚¬ìœ **
- ì¹´í…Œê³ ë¦¬ ê²€ìƒ‰ ì‹œ ì¤‘ë³µ ì œê±° ë¡œì§ ì˜¤ë¥˜
- null ê°’ ì²˜ë¦¬ ë¯¸í¡
- ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì„ ë•Œ ì²˜ë¦¬ ë¶€ì¡±

**2. ì˜¤ë¥˜ ì½”ë“œ**
```java
// InterviewerController.java - ë©´ì ‘ê´€ ëª©ë¡ ì¡°íšŒ ì˜¤ë¥˜
@GetMapping("/interviewer")
public String showIntrList(@RequestParam(value = "intrCate", required = false) String intrCate, Model model) {
    List<InterviewerDTO> interviewers;
    if (intrCate != null && !intrCate.isEmpty()) {
        // ì—¬ëŸ¬ ì¹´í…Œê³ ë¦¬(ì½¤ë§ˆêµ¬ë¶„) ê²€ìƒ‰ ì§€ì›
        String[] categories = intrCate.split(",");
        interviewers = new java.util.ArrayList<>();
        for (String cate : categories) {
            interviewers.addAll(interviewerService.getInterviewerListByCategory(cate));
        }
        // ì¤‘ë³µ ì œê±° - ì—¬ê¸°ì„œ ì˜¤ë¥˜ ë°œìƒ ê°€ëŠ¥
        interviewers = interviewers.stream().distinct().toList();
    } else {
        // ì „ì²´ ëª©ë¡
        interviewers = interviewerService.getInterviewerList();
    }
    if (interviewers == null) {
        interviewers = java.util.Collections.emptyList();
    }
    model.addAttribute("interviewers", interviewers);
    return "interviewer/List";
}
```

**3. í•´ê²° ë°©ì•ˆ**
```java
// ê°œì„ ëœ ë©´ì ‘ê´€ ëª©ë¡ ì¡°íšŒ
@GetMapping("/interviewer")
public String showIntrList(@RequestParam(value = "intrCate", required = false) String intrCate, 
                          @RequestParam(value = "search", required = false) String search,
                          Model model) {
    try {
        List<InterviewerDTO> interviewers = new ArrayList<>();
        
        if (intrCate != null && !intrCate.trim().isEmpty()) {
            // ì¹´í…Œê³ ë¦¬ ê²€ìƒ‰
            String[] categories = intrCate.split(",");
            Set<InterviewerDTO> uniqueInterviewers = new LinkedHashSet<>();
            
            for (String cate : categories) {
                String trimmedCate = cate.trim();
                if (!trimmedCate.isEmpty()) {
                    List<InterviewerDTO> categoryResults = interviewerService.getInterviewerListByCategory(trimmedCate);
                    if (categoryResults != null) {
                        uniqueInterviewers.addAll(categoryResults);
                    }
                }
            }
            interviewers = new ArrayList<>(uniqueInterviewers);
            
        } else if (search != null && !search.trim().isEmpty()) {
            // ê²€ìƒ‰ ê¸°ëŠ¥
            interviewers = interviewerService.searchInterviewers(search.trim());
            
        } else {
            // ì „ì²´ ëª©ë¡
            interviewers = interviewerService.getInterviewerList();
        }
        
        // null ì²´í¬ ë° ë¹ˆ ë¦¬ìŠ¤íŠ¸ ì²˜ë¦¬
        if (interviewers == null) {
            interviewers = new ArrayList<>();
        }
        
        model.addAttribute("interviewers", interviewers);
        model.addAttribute("selectedCategory", intrCate);
        model.addAttribute("searchKeyword", search);
        model.addAttribute("totalCount", interviewers.size());
        
        return "interviewer/List";
        
    } catch (Exception e) {
        System.err.println("ë©´ì ‘ê´€ ëª©ë¡ ì¡°íšŒ ì˜¤ë¥˜: " + e.getMessage());
        model.addAttribute("interviewers", new ArrayList<>());
        model.addAttribute("error", "ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        return "interviewer/List";
    }
}
```

**4. ê²°ë¡ **
- LinkedHashSet ì‚¬ìš©ìœ¼ë¡œ ì¤‘ë³µ ì œê±° ì•ˆì •ì„± í–¥ìƒ
- ê²€ìƒ‰ ê¸°ëŠ¥ ì¶”ê°€ë¡œ ì‚¬ìš©ì„± ê°œì„ 
- ì˜ˆì™¸ ì²˜ë¦¬ë¡œ ì‹œìŠ¤í…œ ì•ˆì •ì„± í™•ë³´

### 3-3. ë©´ì ‘ê´€ ìƒì„¸ ì¡°íšŒ ë° ë¦¬ë·° ì˜¤ë¥˜

**1. ì˜¤ë¥˜ ì‚¬ìœ **
- ë©´ì ‘ê´€ ìƒì„¸ ì •ë³´ ì¡°íšŒ ì‹œ JOIN ì¿¼ë¦¬ ì˜¤ë¥˜
- ë¦¬ë·° ëª©ë¡ ì¡°íšŒ ì‹œ í˜ì´ì§• ì²˜ë¦¬ ë¶€ì¡±
- ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë©´ì ‘ê´€ ID ì ‘ê·¼ ì‹œ ì²˜ë¦¬ ë¯¸í¡

**2. ì˜¤ë¥˜ ì½”ë“œ**
```java
// InterviewerController.java - ë©´ì ‘ê´€ ìƒì„¸ ì¡°íšŒ ì˜¤ë¥˜
@GetMapping("/interviewer/{intrId}")
public String getInterviewerDetail(@PathVariable("intrId") Long intrId, Model model) {
    InterviewerDetailDTO detail = interviewerService.getInterviewerDetail(intrId);
    model.addAttribute("interviewer", detail);
    // ë¦¬ë·° ë¦¬ìŠ¤íŠ¸ ì¶”ê°€
    List<Review> reviews = reviewRepository.findByIntrIdOrderByCreatedDtDesc(intrId.intValue());
    model.addAttribute("reviews", reviews);
    return "interviewer/detail";
}
```

**3. í•´ê²° ë°©ì•ˆ**
```java
// ê°œì„ ëœ ë©´ì ‘ê´€ ìƒì„¸ ì¡°íšŒ
@GetMapping("/interviewer/{intrId}")
public String getInterviewerDetail(@PathVariable("intrId") Long intrId, 
                                 @RequestParam(value = "page", defaultValue = "0") int page,
                                 @RequestParam(value = "size", defaultValue = "10") int size,
                                 Model model) {
    try {
        // ë©´ì ‘ê´€ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
        if (intrId == null || intrId <= 0) {
            return "redirect:/interviewer?error=invalid_id";
        }
        
        InterviewerDetailDTO detail = interviewerService.getInterviewerDetail(intrId);
        if (detail == null) {
            return "redirect:/interviewer?error=not_found";
        }
        
        model.addAttribute("interviewer", detail);
        
        // ë¦¬ë·° ëª©ë¡ ì¡°íšŒ (í˜ì´ì§• ì ìš©)
        Pageable pageable = PageRequest.of(page, size, Sort.by("createdDt").descending());
        Page<Review> reviewPage = reviewRepository.findByIntrId(intrId.intValue(), pageable);
        
        model.addAttribute("reviews", reviewPage.getContent());
        model.addAttribute("currentPage", page);
        model.addAttribute("totalPages", reviewPage.getTotalPages());
        model.addAttribute("totalElements", reviewPage.getTotalElements());
        model.addAttribute("hasNext", reviewPage.hasNext());
        model.addAttribute("hasPrevious", reviewPage.hasPrevious());
        
        return "interviewer/detail";
        
    } catch (Exception e) {
        System.err.println("ë©´ì ‘ê´€ ìƒì„¸ ì¡°íšŒ ì˜¤ë¥˜: " + e.getMessage());
        return "redirect:/interviewer?error=system";
    }
}

// ë¦¬ë·° ë“±ë¡ ê°œì„ 
@PostMapping("/interviewer/{intrId}/review")
public String addReview(@PathVariable("intrId") Long intrId,
                       @RequestParam("rating") Integer rating,
                       @RequestParam("content") String content,
                       Principal principal,
                       RedirectAttributes redirectAttributes) {
    try {
        if (principal == null) {
            redirectAttributes.addFlashAttribute("error", "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            return "redirect:/loginmain";
        }
        
        // ì…ë ¥ê°’ ê²€ì¦
        if (rating == null || rating < 1 || rating > 5) {
            redirectAttributes.addFlashAttribute("error", "í‰ì ì€ 1-5 ì‚¬ì´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return "redirect:/interviewer/" + intrId;
        }
        
        if (content == null || content.trim().isEmpty()) {
            redirectAttributes.addFlashAttribute("error", "ë¦¬ë·° ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return "redirect:/interviewer/" + intrId;
        }
        
        String userId = principal.getName();
        
        // ì¤‘ë³µ ë¦¬ë·° ì²´í¬
        if (reviewRepository.existsByIntrIdAndUserId(intrId.intValue(), userId)) {
            redirectAttributes.addFlashAttribute("error", "ì´ë¯¸ ë¦¬ë·°ë¥¼ ì‘ì„±í•˜ì…¨ìŠµë‹ˆë‹¤.");
            return "redirect:/interviewer/" + intrId;
        }
        
        // ë¦¬ë·° ì €ì¥
        Review review = new Review();
        review.setIntrId(intrId.intValue());
        review.setUserId(userId);
        review.setRating(rating);
        review.setContent(content.trim());
        review.setCreatedDt(LocalDateTime.now());
        
        reviewRepository.save(review);
        
        redirectAttributes.addFlashAttribute("message", "ë¦¬ë·°ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
        return "redirect:/interviewer/" + intrId;
        
    } catch (Exception e) {
        redirectAttributes.addFlashAttribute("error", "ë¦¬ë·° ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        return "redirect:/interviewer/" + intrId;
    }
}
```

**4. ê²°ë¡ **
- í˜ì´ì§• ì²˜ë¦¬ë¡œ ì„±ëŠ¥ ìµœì í™”
- ì…ë ¥ê°’ ê²€ì¦ ë° ì¤‘ë³µ ì²´í¬
- ìƒì„¸í•œ ì˜¤ë¥˜ ì²˜ë¦¬ë¡œ ì‚¬ìš©ì ê²½í—˜ ê°œì„ 

================================================================================
ğŸ“Š 4. ê³µí†µ í•´ê²° ë°©ì•ˆ ë° ëª¨ë²” ì‚¬ë¡€
================================================================================

### 4-1. ì˜ˆì™¸ ì²˜ë¦¬ íŒ¨í„´

```java
// í‘œì¤€ ì˜ˆì™¸ ì²˜ë¦¬ íŒ¨í„´
try {
    // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
    return result;
} catch (IllegalArgumentException e) {
    // ì…ë ¥ê°’ ì˜¤ë¥˜
    redirectAttributes.addFlashAttribute("error", e.getMessage());
    return "redirect:/form";
} catch (EntityNotFoundException e) {
    // ë°ì´í„° ì—†ìŒ
    redirectAttributes.addFlashAttribute("error", "ìš”ì²­í•œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    return "redirect:/list";
} catch (Exception e) {
    // ì‹œìŠ¤í…œ ì˜¤ë¥˜
    System.err.println("ì˜¤ë¥˜ ë°œìƒ: " + e.getMessage());
    e.printStackTrace();
    redirectAttributes.addFlashAttribute("error", "ì‹œìŠ¤í…œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    return "redirect:/main";
}
```

### 4-2. ê¶Œí•œ ê²€ì¦ íŒ¨í„´

```java
// í‘œì¤€ ê¶Œí•œ ê²€ì¦ íŒ¨í„´
private boolean hasPermission(String resourceId, String userId, String requiredRole) {
    try {
        // 1. ì‚¬ìš©ì ì¡´ì¬ í™•ì¸
        Users user = usersRepository.findByUserId(userId);
        if (user == null) return false;
        
        // 2. ì—­í•  í™•ì¸
        if (!requiredRole.equals(user.getUserRole())) return false;
        
        // 3. ë¦¬ì†ŒìŠ¤ ì†Œìœ ê¶Œ í™•ì¸ (í•„ìš”ì‹œ)
        if (resourceId != null) {
            return checkResourceOwnership(resourceId, userId);
        }
        
        return true;
    } catch (Exception e) {
        return false;
    }
}
```

### 4-3. ì…ë ¥ê°’ ê²€ì¦ íŒ¨í„´

```java
// í‘œì¤€ ì…ë ¥ê°’ ê²€ì¦ íŒ¨í„´
private void validateInput(String input, String fieldName, int maxLength) {
    if (input == null) {
        throw new IllegalArgumentException(fieldName + "ì„(ë¥¼) ì…ë ¥í•´ì£¼ì„¸ìš”.");
    }
    
    String trimmed = input.trim();
    if (trimmed.isEmpty()) {
        throw new IllegalArgumentException(fieldName + "ì„(ë¥¼) ì…ë ¥í•´ì£¼ì„¸ìš”.");
    }
    
    if (trimmed.length() > maxLength) {
        throw new IllegalArgumentException(fieldName + "ì€(ëŠ”) " + maxLength + "ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    }
}
```

================================================================================
ğŸ¯ 5. ê²°ë¡ 
================================================================================

### 5-1. ì£¼ìš” ì„±ê³¼

1. **AI ê¸°ëŠ¥ ì•ˆì •í™”**
   - GPT API í˜¸ì¶œ ì‹œ ì˜ˆì™¸ ì²˜ë¦¬ ê°•í™”
   - ì„¸ì…˜ ê´€ë¦¬ ë¡œì§ ê°œì„ 
   - í† í° ì œí•œ ë¬¸ì œ í•´ê²°

2. **ìì†Œì„œ ì‹œìŠ¤í…œ ê°œì„ **
   - ì„¹ì…˜ë³„ ë¶„í•  ì²˜ë¦¬ë¡œ ì•ˆì •ì„± í–¥ìƒ
   - AI í”¼ë“œë°± ìƒì„± ì˜¤ë¥˜ í•´ê²°
   - ë°ì´í„° íŒŒì‹± ë¡œì§ ê°œì„ 

3. **ë©´ì ‘ê´€ CRUD ê°•í™”**
   - ê¶Œí•œ ê²€ì¦ ë¡œì§ êµ¬í˜„
   - ê²€ìƒ‰ ê¸°ëŠ¥ ì¶”ê°€
   - í˜ì´ì§• ì²˜ë¦¬ë¡œ ì„±ëŠ¥ ìµœì í™”

### 5-2. í•™ìŠµí•œ êµí›ˆ

1. **ì˜ˆì™¸ ì²˜ë¦¬ì˜ ì¤‘ìš”ì„±**
   - ëª¨ë“  ì™¸ë¶€ API í˜¸ì¶œì— ì˜ˆì™¸ ì²˜ë¦¬ í•„ìˆ˜
   - ì‚¬ìš©ìì—ê²Œ ì ì ˆí•œ ì˜¤ë¥˜ ë©”ì‹œì§€ ì œê³µ
   - ì‹œìŠ¤í…œ ì•ˆì •ì„± í™•ë³´

2. **ê¶Œí•œ ê²€ì¦ì˜ í•„ìš”ì„±**
   - ëª¨ë“  ë¯¼ê°í•œ ì‘ì—…ì— ê¶Œí•œ ê²€ì¦ êµ¬í˜„
   - ì‚¬ìš©ì ì—­í• ë³„ ì ‘ê·¼ ì œì–´
   - ë³´ì•ˆ ê°•í™”

3. **ì…ë ¥ê°’ ê²€ì¦ì˜ í•„ìˆ˜ì„±**
   - ëª¨ë“  ì‚¬ìš©ì ì…ë ¥ì— ê²€ì¦ ë¡œì§ ì ìš©
   - SQL Injection, XSS ê³µê²© ë°©ì§€
   - ë°ì´í„° ë¬´ê²°ì„± ë³´ì¥

### 5-3. í–¥í›„ ê°œì„  ë°©í–¥

1. **ì„±ëŠ¥ ìµœì í™”**
   - ìºì‹± ì‹œìŠ¤í…œ ë„ì…
   - ë¹„ë™ê¸° ì²˜ë¦¬ í™•ëŒ€
   - ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ìµœì í™”

2. **ì‚¬ìš©ì ê²½í—˜ ê°œì„ **
   - ì‹¤ì‹œê°„ ì•Œë¦¼ ê¸°ëŠ¥
   - ì§„í–‰ ìƒí™© í‘œì‹œ
   - ëª¨ë°”ì¼ ë°˜ì‘í˜• ê°œì„ 

3. **ì½”ë“œ í’ˆì§ˆ í–¥ìƒ**
   - ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±
   - ì½”ë“œ ë¦¬íŒ©í† ë§
   - ë¬¸ì„œí™” ê°œì„ 

ì´ëŸ¬í•œ ì˜¤ë¥˜ í•´ê²° ê³¼ì •ì„ í†µí•´ ë”ìš± ì•ˆì •ì ì´ê³  ì‚¬ìš©ì ì¹œí™”ì ì¸ AI ë©´ì ‘ í”Œë«í¼ì„ êµ¬ì¶•í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

================================================================================ 