<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>

  <script src="https://code.jquery.com/jquery-latest.js"></script>
   <link rel="stylesheet" th:href="@{/css/reservation.css}" />
   <script src="https://cdn.iamport.kr/v1/iamport.js"></script>
   <!-- ë‹¬ë ¥ -->
   <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
   
   <!-- ìˆ˜ì •í¼ --> 
   <link rel="stylesheet" th:href="@{/css/memberformEdit.css}">
   <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  <!--  <script th:src="@{/js/check2.js}"></script> -->
  
  <!-- ì˜ˆì›ì¶”ê°€) jaso.cssë¶„ë¦¬. ì—¬ê¸°ì„œ ì„í¬íŠ¸ -->
  <link rel="stylesheet" th:href="@{/css/jaso.css}">
  
  <meta charset="UTF-8">
  <title>ì·¨ì¤€ìƒ ë§ˆì´í˜ì´ì§€</title>
  <link rel="stylesheet" th:href="@{/css/main.css}">
  <link rel="stylesheet" th:href="@{/css/common.css}">
  <link rel="stylesheet" th:href="@{/css/reservation.css}">
  
  
  <style>
    html, body {
      height: auto;
      min-height: 100vh;
      margin: 0;
      padding: 0;
      overflow-y: auto;
    }

    .mypage-layout {
	  display: flex;
	  margin: 40px auto;
	  background: #fff;
	  border-radius: 16px;
	  box-shadow: 0 16px 24px rgba(0, 0, 0, 0.08);
	  overflow: hidden; /* ë‘¥ê·¼ ëª¨ì„œë¦¬ ì•ˆ ë„˜ì¹˜ê²Œ */
	  box-sizing: border-box;
  
  /* âœ… ë°°ê²½ê³¼ í…Œë‘ë¦¬ */
  /* background: #fff;
  border-radius: 16px; 
  box-shadow: 0 16px 24px rgba(0, 0, 0, 0.08); 
     */
}
    .sidebar {
      flex: 0 0 230px;
      background: #fff4e6;  /* â† ì—°í•œ ë² ì´ì§€ (ì‚¬ì´ë“œë°”) */
      padding: 36px 0 0 0;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .sidebar-menu {
      display: flex;
      flex-direction: column;
      gap: 5px;
      padding-left: 24px;
    }

    .sidebar-menu a {
      font-size: 17px;
      color: #5a4220;  /* ì§„í•œ ë¸Œë¼ìš´ ê¸€ì”¨ */
      text-decoration: none;
      padding: 10px 0 10px 12px;
      border-radius: 5px 0 0 5px;
      transition: background 0.18s;
      font-weight: 500;
      letter-spacing: -0.2px;
    }

    .sidebar-menu a.active,
    .sidebar-menu a:hover {
      background: #edd3b3;  /* ì¡°ê¸ˆ ë” ì—°í•œ ë² ì´ì§€(hover) */
  color: #b9936d;       /* ì›ë³¸ ì§„ë² ì´ì§€ë¡œ ê°•ì¡° */
      font-weight: bold;
    }

    .sidebar-bottom {
      /* padding-left: 24px; */
      margin-top: 38px;
      margin-bottom: 38px;
    }

    .sidebar-bottom a {
      color: #d34040;
      font-weight: bold;
      text-decoration: none;
      font-size: 15px;
      transition: color 0.2s;
    }

    .sidebar-bottom a:hover {
      color: #b80000;
      background: none;
      text-decoration: underline;
    }

    .main-content {
   	 /* ê¸°ì¡´ ì†ì„± ìœ ì§€ */
  flex: 1;
  width: 100%;
  min-width: 900px;
  padding: 46px 44px;
  background: #f8f9fa; /* ê±°ì˜ í°ìƒ‰ì— ê°€ê¹Œìš´ ë² ì´ì§€ */
  box-sizing: border-box;

  /* â†“ ìì‹ë“¤ì„ ì„¸ë¡œ ë°©í–¥(column)ìœ¼ë¡œ ìŒ“ë˜, ê°€ë¡œ(ìˆ˜í‰) ì¤‘ì•™ ì •ë ¬ */
  display: flex;
  flex-direction: column;
  align-items: center;
	  
    /* 
      flex: 1;
      padding: 46px 44px;
      background: #f7f9fc;
      box-sizing: border-box;
      min-width: 0; */
    }

    .info-cards {
      display: flex;
      gap: 36px;
      justify-content: center;
    }

    .member-info, .stat-info {
      margin-bottom: 24px;
    }

    .member-info {
      background: #fff;
      border-radius: 9px;
      box-shadow: 0 2px 8px rgba(135,160,180,0.07);
      padding: 32px 38px 30px 38px;
      min-width: 320px;
      flex: 1;
    }

    .member-info h2 {
      margin-top: 0; font-size: 21px; color: #314266; margin-bottom: 16px;
    }

    .member-info-list {
      font-size: 16px; line-height: 2.1; color: #222;
    }

    .stat-info {
      background: #eaf1fb;
      border-radius: 9px;
      box-shadow: 0 2px 8px rgba(70,110,180,0.06);
      padding: 32px 40px;
      min-width: 220px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .stat-info h2 {
      margin-top: 0; font-size: 20px; color: #2951a3; margin-bottom: 18px;
    }

    .stat-info .point-value {
      font-size: 25px; color: #314266; font-weight: bold; margin-bottom: 8px;
    }

	#editContainer,
#activityContainer,
#jasoContainer {
  max-width: 840px;
  min-width: 840px;
  width: 100%;
  margin: 0 auto;
}

    #editContainer .form-frame {
    margin:auto;
      width: 100%;
      max-width: 360px;
    }

    @media (max-width: 900px) {
      .mypage-layout { flex-direction: column; }
      .sidebar {
        width: 100%;
        height: auto;
        flex-direction: row;
        padding: 0;
      }
      .info-cards { flex-direction: column; gap: 14px; }
    }
  </style>

<script th:inline="javascript">
  /*<![CDATA[*/
  var reservedSlots = /*[[${reservedSlotsJson}]]*/ {};
  console.log("ğŸ“¦ reservedSlots í™•ì¸:", reservedSlots);
  /*]]>*/
</script>
</head>
<body>
<div th:replace="fragments/header :: header"></div>

  <div class="mypage-layout">
   <!-- ì‚¬ì´ë“œë°” -->
   <nav class="sidebar">
      <div>
        <div class="sidebar-menu">

          <a th:href="@{/mypage}">ë‚´ ì •ë³´</a>
          <a th:href="@{/memberEdit}" id="memberEdit">ë‚´ ì •ë³´ ìˆ˜ì •</a>
          <!-- <a href="#" id="memberEdit">ë‚´ ì •ë³´ ìˆ˜ì •</a> -->
          <a th:href="@{/memberActivity}" id="memberActivity">ë‚´ í™œë™ ê´€ë¦¬</a>
          <!--  <a href="#" id="loadReservations">ì¼ì • ê´€ë¦¬</a> -->
          <a th:href="@{/memschedule}" id="loadReservations">ì¼ì • ê´€ë¦¬</a>
          <a href="#" id="loadJaso">ìì†Œì„œ ê´€ë¦¬</a>
          <a th:href="@{/resume/list}">ì´ë ¥ì„œ ê´€ë¦¬</a> 
          <a href="#" id="loadPaymentList">ê²°ì œ ë‚´ì—­</a> <!-- ê²°ì œë‚´ì—­ íƒ­ ë˜ëŠ” ë²„íŠ¼ -->
          <a th:href="@{/jobsite}">ì·¨ì—… ì‚¬ì´íŠ¸</a>
          <div class="sidebar-bottom">
            <!-- í˜ì´ì§€ ì´ë™ ì—†ì´ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œë§Œ ë™ì‘ -->
            <a href="#" id="withdrawBtn" style="color:#d34040;">íšŒì› íƒˆí‡´</a>
          </div>
          
        </div>
      </div>
   </nav>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <section class="main-content">
      <div class="info-cards">
        <!-- íšŒì› ì •ë³´ -->
        <div class="member-info">
          <h2>íšŒì› ì •ë³´</h2>
          <div class="member-info-list">
            <div><strong>ì•„ì´ë””:</strong> <span th:text="${users.userId}">intr1</span></div>
            <div><strong>ì´ë¦„:</strong> <span th:text="${users.userName}">í™ë©´ì ‘</span></div>
            <div><strong>í•¸ë“œí°ë²ˆí˜¸:</strong> <span th:text="${users.userNum}">010-0000-0000</span></div>
            <div><strong>ì´ë©”ì¼:</strong> <span th:text="${users.userEmail}">intr@naver.com</span></div>
            <div><strong>ì£¼ì†Œ:</strong> <span th:text="${users.userAdd + ' ' + users.userAddDetail}">ì£¼ì†Œ+ìƒì„¸ì£¼ì†Œ</span></div>
            <div><strong>ê°€ì…ì¼:</strong> <span th:text="${users.createdDt}">2025-06-27</span></div>
          </div>
        </div>
        
        <!-- í¬ì¸íŠ¸ë§Œ í‘œì‹œí•˜ëŠ” í™œë™í†µê³„ -->
        <div class="stat-info">
          <h2>ë‚˜ì˜ í¬ì¸íŠ¸</h2>
           	<div class="point-value" th:text="${point + 'P'}">
           	<!--  <div th:text="${point + 'P'}"></div> -->
           	</div>   
        	<!--í™˜ì „ ë²„íŠ¼ ì¶”ê°€ -->
  			<button id="exchangeBtn" type="button" style="margin-top: 10px; padding: 8px 16px;">í™˜ì „í•˜ê¸°</button>
			<!-- ì˜ˆ: í™˜ì „ ëª¨ë‹¬ì„ ë„£ì„ í˜ì´ì§€ -->
			<div th:replace="mypage/exchangeModal :: exchangeModal"></div>
        </div>

		<!-- 'ë‚´ ì˜ˆì•½ ëª©ë¡' >> ì¼ì •ê´€ë¦¬-->
		<!-- <div id="schedule"> -->
		<div id="reservationContainer" style="display:none;"></div>
		<!-- </div> -->

		<!-- ê²°ì œë‚´ì—­ í‘œì‹œ ì˜ì—­ -->
		<div id="paymentListContainer" style="display:none;"></div>
         
        <!-- ë§ˆì´í˜ì´ì§€ ë‚´ì •ë³´ ìˆ˜ì • -->
        <div id="editContainer" style="display:none; width:100%; justify-content:center;"></div>
        <!-- ë‚´í™œë™ê´€ë¦¬ ì„ì‹œ-->
        <div id="activityContainer" style="display:none;"></div>
        <!-- ìì†Œì„œ ê´€ë¦¬ ë©”ë‰´ ì»¨í…Œì´ë„ˆ-->
        <!-- <div th:replace="~{mypage/jasolist :: jasoList(jasoList=${jasoList})}"></div> -->
        <div id="jasoContainer" style="display:none;"></div>
        </div>
    </section>
  </div>
  
 <!-- íƒˆí‡´ íŒì—… Modal (ì²˜ìŒì—ëŠ” display:none; ìˆ¨ê²¨ë‘ ) -->
<div id="withdrawModal" style="display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.25); z-index:9999;">
  <div style="background:#fff; width:350px; margin:120px auto; padding:32px 24px 16px 24px; border-radius:10px; box-shadow:0 4px 24px rgba(0,0,0,0.16); position:relative;">
    <h2 style="margin-bottom:18px;">ì •ë§ë¡œ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h2>
    <form id="withdrawForm">
      <!-- ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ -->
      <div style="margin-bottom:10px;">
        <label>í˜„ì¬ ë¹„ë°€ë²ˆí˜¸</label><br>
        <input type="password" name="currentPass" style="width:100%;" required />
      </div>
      <div style="margin-bottom:18px;">
        <label>ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label><br>
        <input type="password" name="confirmPass" style="width:100%;" required />
      </div>
      <!-- ë²„íŠ¼ ì˜ì—­ -->
      <div style="display:flex; justify-content:space-between;">
        <button type="submit" style="background:#d34040; color:#fff; border:none; padding:7px 20px; border-radius:5px;">í™•ì¸</button>
        <button type="button" id="cancelWithdraw" style="background:#ccc; color:#222; border:none; padding:7px 20px; border-radius:5px;">ì·¨ì†Œ</button>
      </div>
    </form>
  </div>
</div>
  
 <script th:src="@{/js/memformEdit.js}"></script>  


  <!-- íšŒì›ì •ë³´ ìˆ˜ì • í›„ ë©”ì„¸ì§€ -->
<script th:if="${editSuccess != null}" th:inline="javascript">
	 alert('[[${editSuccess}]]');
</script>
  
  
<script>
// ê³µí†µ í•¨ìˆ˜
function hideAllFragments() {
	  $('#reservationContainer, #editContainer, #activityContainer, #reviewContainer, #jasoContainer, #exchangeBtn,#paymentListContainer').hide();
	  $('.member-info, .stat-info').hide();
	}

</script> 

<script>
$(function(){
  // 1. "íšŒì› íƒˆí‡´" ë§í¬ í´ë¦­ ì‹œ íŒì—… ì—´ê¸°
  $("#withdrawBtn").on("click", function(e){
    e.preventDefault(); // ë§í¬ ê¸°ë³¸ë™ì‘ ë§‰ê¸°(ìƒˆë¡œê³ ì¹¨X)
    $("#withdrawModal").show();
  });

  // 2. ì·¨ì†Œ ë²„íŠ¼ í´ë¦­ ì‹œ íŒì—… ë‹«ê¸°
  $("#cancelWithdraw").on("click", function(){
    $("#withdrawModal").hide();
    $("#withdrawForm")[0].reset(); // ì…ë ¥ê°’ ì´ˆê¸°í™”
  });

  // 3. í¼ ì œì¶œ(í™•ì¸) ì‹œ AJAXë¡œ íƒˆí‡´ ìš”ì²­
  $("#withdrawForm").on("submit", function(e){
    e.preventDefault();

    // ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
    var currentPass = $("input[name='currentPass']").val();
    var confirmPass = $("input[name='confirmPass']").val();

    // 1ì°¨ ì²´í¬: ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ í™•ì¸
    if(currentPass !== confirmPass){
      alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
      return;
    }

    // AJAXë¡œ ì„œë²„ì— íƒˆí‡´ ìš”ì²­
    $.ajax({
      type: "POST",
      url: "/member/withdraw", // ì»¨íŠ¸ë¡¤ëŸ¬ ë§¤í•‘ì— ë§ì¶°ì„œ
      data: { currentPass: currentPass },
      success: function(result){
        if(result === "success"){
          alert("íšŒì› íƒˆí‡´ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
          window.location.href = "/main"; // íƒˆí‡´ í›„ ì´ë™í•  í˜ì´ì§€
        }else if(result === "fail"){
          alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë¦½ë‹ˆë‹¤.");
        }else{
          alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
        }
      },
      error: function(){
        alert("ìš”ì²­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      }
    });
  });
});
</script>

<!-- ì¼ì •ê´€ë¦¬ -->
<script>
	// ì¼ì •ê´€ë¦¬ íƒ­ í´ë¦­ ì‹œ ì˜ˆì•½ ëª©ë¡ fragment ë¡œë”©
	$(function(){
	  $('#loadReservations').on('click', function(e){
	    e.preventDefault();

	    // 1) íƒ­ active í† ê¸€
	    $('.sidebar-menu a').removeClass('active');
	    $(this).addClass('active');
	    
	    // ì˜ˆì› ì¶”ê°€	>>	ìˆ˜ì •í¼ fragment ìˆ¨ê¸°ê¸°í•´ì•¼ ë©”ë‰´ í´ë¦­ì‹œ í˜¸ì¶œë¨
		hideAllFragments();  // ì¶”ê°€. ìˆ¨ê¸°ëŠ” ì½”ë“œê°€ ë¨¼ì € ì™€ì•¼ í•¨. 
		// $('#editContainer').hide();	//	 hideAllì´ ìˆì–´ì„œ ê°œë³„ì ìœ¼ë¡œ ìˆ¨ê¹€ ì•ˆ í•´ë„ ë¨
		$('#reservationContainer').show();    // ì´ê±° ê¼­ ìˆì–´ì•¼ fragmentê°€ ë³´ì„!
	    
	    // 2) ì¹´ë“œ ìš”ì†Œë§Œ ìˆ¨ê¸°ê¸°
	    $('.member-info, .stat-info').hide();

	    // 3) AJAX ë¡œë“œ
	    $('#reservationContainer').load('/reservation/mylist', function(resp, status, xhr){
	      if (status !== 'success') {
	        alert('ì˜ˆì•½ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨: ' + xhr.statusText);
	        return;
	      }
        // 4) reservedSlotsJson ì¶”ì¶œ
        const $jsonScript = $('#reservationContainer').find('#reservedSlotsJson');
        if ($jsonScript.length) {
          try {
            window.reservedSlots = JSON.parse($jsonScript.text());
            console.log("âœ… reservedSlots loaded:", window.reservedSlots);
          } catch (e) {
            console.error("âŒ reservedSlots íŒŒì‹± ì‹¤íŒ¨:", e);
            window.reservedSlots = {};
          }
        } else {
          console.warn("âš ï¸ reservedSlotsJson íƒœê·¸ ì—†ìŒ");
          window.reservedSlots = {};
        }

        // 5) ìŠ¤ì¼€ì¤„ëŸ¬ ì´ˆê¸°í™” í•¨ìˆ˜ í˜¸ì¶œ
        if (typeof window.initReservationSchedule === 'function') {
          window.initReservationSchedule();
        } else {
          console.warn("âš ï¸ initReservationSchedule í•¨ìˆ˜ê°€ ì—†ìŒ");
        }
      });
    });

    // âœ… í˜ì´ì§€ ë¡œë“œì‹œ ?tab=schedule ì´ë©´ ìë™ í´ë¦­
    const params = new URLSearchParams(window.location.search);
    if (params.get("tab") === "schedule") {
      $('#loadReservations').click();
    }
  });
</script>

	<!-- ì˜ˆì•½ë³€ê²½ -->
	<script>
// ğŸ’¡ ìŠ¤ì¼€ì¤„ëŸ¬ ì´ˆê¸°í™” í•¨ìˆ˜
window.initReservationSchedule = function() {
  $(document).on('click', '.action-link.change', function(e){
    e.preventDefault();

    const $tr = $(this).closest('tr');
    const resId = $tr.find('td:eq(0)').text().trim();
    const intrName = $tr.find('td:eq(1)').text().trim();
    const datePart = $tr.find('td:eq(2)').text().split(' ')[0];

    $('#infoResId').text(resId);
    $('#infoIntrName').text(intrName);

    flatpickr("#calendarPicker", {
      inline: true,
      dateFormat: "Y-m-d",
      defaultDate: datePart,
      onChange: function(_, dateStr){
        window.disableTimeButtons(dateStr);  // âœ… ë¹„í™œì„±í™” í˜¸ì¶œ
      }
    });

    window.disableTimeButtons(datePart); // âœ… ì´ˆê¸° ë‚ ì§œë„ ë¹„í™œì„±í™” ì²´í¬
    $('#schedulerPanel').slideDown();
  });

  // ì‹œê°„ ë²„íŠ¼ ì„ íƒ
  $(document).on('click', '.time-buttons button', function(){
    if ($(this).hasClass('disabled')) return;
    $('.time-buttons button').removeClass('active');
    $(this).addClass('active');
  });

  // ì €ì¥ ë²„íŠ¼
  $(document).on('click', '#saveChange', function(){
    const resId = $('#infoResId').text();
    const newDate = $('#calendarPicker').val();
    const newTime = $('.time-buttons button.active').data('time');

    if (!newDate || !newTime) {
      alert("ë‚ ì§œì™€ ì‹œê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
      return;
    }

    $.post('/reservation/reschedule', { resId, newDate, newTime })
      .done(() => {
        alert('ì˜ˆì•½ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
        $('#reservationContainer').load('/reservation/mylist');
      })
      .fail(xhr => {
        alert('ë³€ê²½ ì‹¤íŒ¨: ' + xhr.responseText);
      });
  });

  // ì·¨ì†Œ ë²„íŠ¼
  $(document).on('click', '#cancelChange', function(){
    $('#schedulerPanel').slideUp();
  });
};

// ğŸ’¡ ì˜ˆì•½ëœ ì‹œê°„ ë¹„í™œì„±í™” í•¨ìˆ˜
window.disableTimeButtons = function(dateStr){
  const taken = (window.reservedSlots && window.reservedSlots[dateStr]) ? window.reservedSlots[dateStr] : [];

  $('.time-buttons button').each(function(){
    const $btn = $(this);
    const time = $btn.data('time');

    if (taken.includes(time)) {
      $btn.prop('disabled', true).addClass('disabled');
    } else {
      $btn.prop('disabled', false).removeClass('disabled');
    }
  });
};
</script>

	<!-- í™˜ë¶ˆ -->
	<script>
$(document).on('click', '.action-link.cancel', function(e){
	  e.preventDefault();
	  const resId = $(this).data('res-id');
	  console.log("ğŸ§¾ ì·¨ì†Œí•  ì˜ˆì•½ resId:", resId);  

	  if (!resId) {
	    alert("ì˜ˆì•½ IDê°€ ì—†ìŠµë‹ˆë‹¤.");
	    return;
	  }

	  if (!confirm("ì •ë§ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

	  $.get('/reservation/cancel?resId=' + resId)
	    .done(function(){
	      alert("ì˜ˆì•½ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤. í¬ì¸íŠ¸ê°€ í™˜ë¶ˆë©ë‹ˆë‹¤.");
	      $('#reservationContainer').load('/reservation/mylist'); // í”„ë˜ê·¸ë¨¼íŠ¸ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
	    })
	    .fail(function(xhr){
	      alert("ì·¨ì†Œ ì‹¤íŒ¨: " + xhr.responseText);
	    });
	});

// ë‚´ì •ë³´ ìˆ˜ì •
$('#memberEdit').on('click', function(e){
	e.preventDefault();
  $('.sidebar-menu a').removeClass('active');
  $(this).addClass('active');
  hideAllFragments();  // âœ… ì¶”ê°€
  
  $('#reservationContainer').hide();	
  $('.member-info, .stat-info').hide();
  $('#editContainer').css('display','flex').load('/memberEdit', function(resp, status, xhr){
    if(status !== 'success') {
      $('#editContainer').html('<div>ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨</div>');
      return;
    }
    // â˜…â˜…â˜…â˜…â˜… ë™ì ìœ¼ë¡œ ë“¤ì–´ì˜¨ í¼ì— ì´ë²¤íŠ¸ë¥¼ ë‹¤ì‹œ ì—°ê²°
    bindEmailDomainEvents();
  });
});
	
// ì •ë³´ ìˆ˜ì • ì·¨ì†Œ ë²„íŠ¼  >>  ì—†ì•°
/* $(document).on('click', '#editCancelBtn', function(){
  hideAllFragments();  // âœ… ì¶”ê°€
  $('#editContainer').hide();
  $('.member-info, .stat-info').show();
}); */

// ë‚´í™œë™ê´€ë¦¬
$('#memberActivity').on('click', function(e){
  e.preventDefault();
  $('.sidebar-menu a').removeClass('active');
  $(this).addClass('active');
  
  hideAllFragments();  // âœ… ì¶”ê°€
  
  $('.member-info, .stat-info, #reservationContainer, #editContainer, #reviewContainer').hide();
  $('#activityContainer').show().load('/mypage/activity', function(resp, status, xhr){
    if (status !== 'success') {
      $('#activityContainer').html('<div>ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨</div>');
    }
  });
});
 
// ìì†Œì„œ ë©”ë‰´ fragment
$('#loadJaso').on('click', function(e) {
    e.preventDefault();
    $('.sidebar-menu a').removeClass('active');
    $(this).addClass('active');

    hideAllFragments(); // ê¸°ì¡´ í•¨ìˆ˜ ì¬í™œìš©
    $('#jasoContainer').show().load('/mypage/jaso/fragment', function(resp, status){
        if (status !== 'success') {
            $('#jasoContainer').html('<p>ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨</p>');
        }
    });
});
 
</script>

<!--ê²°ì œë‚´ì—­ -->
<script>
$(function() {
	  // ê²°ì œë‚´ì—­ íƒ­ ë˜ëŠ” ë²„íŠ¼ í´ë¦­ ì‹œ í”„ë˜ê·¸ë¨¼íŠ¸ ë¡œë“œ
	  $('#loadPaymentList').on('click', function(e) {
	    e.preventDefault();

	    // íƒ­ í™œì„±í™” í† ê¸€ (ì„ íƒì‚¬í•­)
	    $('.sidebar-menu a').removeClass('active');
	    $(this).addClass('active');
	    hideAllFragments();

	    // ë‹¤ë¥¸ ë©”ì¸ ì»¨í…ì¸  ìˆ¨ê¸°ê¸° (í•„ìš”í•˜ë©´)
	    $('.member-info, .stat-info, #reservationContainer').hide();

	    // ê²°ì œë‚´ì—­ ì»¨í…Œì´ë„ˆ ë³´ì´ê¸°
	    $('#paymentListContainer').show();

	    // AJAXë¡œ ê²°ì œë‚´ì—­ í”„ë˜ê·¸ë¨¼íŠ¸ ë¡œë“œ
	    $('#paymentListContainer').load('/payment/mypage/paymentList', function(response, status, xhr) {
	      if (status !== "success") {
	        alert("ê²°ì œ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + xhr.statusText);
	      }
	    });
	  });

	  // í˜ì´ì§€ ë¡œë“œ ì‹œ íŠ¹ì • íŒŒë¼ë¯¸í„°ì— ë”°ë¼ ìë™ í´ë¦­ ì˜ˆì‹œ
	  const params = new URLSearchParams(window.location.search);
	  if (params.get("tab") === "payment") {
	    $('#loadPaymentList').click();
	  }
	});

</script>

<!-- í™˜ì „ì“° -->

<script>
  $(function() {
    $("#exchangeBtn").on("click", function() {
      $("#exchangeModal").show();
    });
    $(document).on("click", "#cancelExchange", function() {
      $("#exchangeModal").hide();
      $("#exchangeForm")[0].reset();
    });
  });
  
  $(function() {
	  $("#exchangeForm").on("submit", function(e) {
	    e.preventDefault();

	    // í¼ ë°ì´í„° ê°ì²´ë¡œ ìˆ˜ì§‘
	    const data = {
	      name: $("input[name='name']").val(),
	      phone: $("input[name='phone']").val(),
	      bank: $("select[name='bank']").val(),
	      account: $("input[name='account']").val(),
	      amount: parseInt($("input[name='amount']").val(), 10)
	    };

	    $.ajax({
	      url: "/point/exchange/request",
	      type: "POST",
	      contentType: "application/json",
	      data: JSON.stringify(data),
	      success: function(response) {
	        if(response.success) {
	          alert(response.message);
	          $("#exchangeModal").hide();
	          $("#exchangeForm")[0].reset();
	          // í¬ì¸íŠ¸ í‘œì‹œ ë¶€ë¶„ ì—…ë°ì´íŠ¸
	          // ê¸°ì¡´ í¬ì¸íŠ¸ ì½ê¸°
	          let currentPointStr = $(".point-value").text();  // ì˜ˆ: "12345P"
	          let currentPoint = parseInt(currentPointStr.replace("P", ""), 10);

	          let newPoint = currentPoint - data.amount;
	          if (newPoint < 0) newPoint = 0;

	          $(".point-value").text(newPoint + "P");
	        } else {
	          alert("ì‹¤íŒ¨: " + response.message);
	        }
	      },
	      error: function() {
	        alert("ì„œë²„ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
	      }
	    });
	  });
	});
</script>


 <script th:inline="javascript">
$(function() {
  console.log("iamport loaded:", typeof IMP !== 'undefined');

  if (typeof IMP !== 'undefined') {
    IMP.init("imp14397622");
  } else {
    console.error("IMP ê°ì²´ê°€ ì •ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤! iamport.jsê°€ ì œëŒ€ë¡œ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.");
  }

  // ì´ë²¤íŠ¸ ìœ„ì„ ë°”ì¸ë”©(ë™ì  ë²„íŠ¼ë„ ë¬¸ì œì—†ê²Œ)
  $(document).on('click', '.btn-pay.btn-card', function(e) {
    e.preventDefault();
    
    console.log("ì¹´ë“œê²°ì œ ë²„íŠ¼ í´ë¦­ë¨");
    const resId = $(this).data('resid');
    console.log("ì„ íƒëœ ì˜ˆì•½ID:", resId);

    const userId = /*[[${userId}]]*/ 'UNKNOWN';
    console.log("ì‚¬ìš©ì ID:", userId);

    const amount = 100; // ê²°ì œ ê¸ˆì•¡ (í•„ìš”ì— ë”°ë¼ ë³€ê²½)

    if (typeof IMP === 'undefined') {
      alert('IMP ê°ì²´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. iamport.js ë¡œë”© ë¬¸ì œ');
      return;
    }

    IMP.request_pay({
      channelKey : "channel-key-01764171-b249-4c16-9d18-e9174fa8e611",
      pay_method: 'card',
      merchant_uid: 'order_' + new Date().getTime(),
      name: 'ë©´ì ‘ ì˜ˆì•½ ê²°ì œ',
      amount: amount,
      buyer_tel: '010-0000-0000'
    }, function(rsp) {
      console.log('IAMPORT response:', rsp);

      if (!rsp.success) {
        alert('ê²°ì œ ì‹¤íŒ¨: ' + rsp.error_msg);
        return;
      }

      $.ajax({
        type: 'POST',
        url: '/payment/save',
        contentType: 'application/json',
        data: JSON.stringify({
          payResno: rsp.merchant_uid,
          payAmount: rsp.paid_amount,
          payStatus: rsp.status,
          resId: resId,
          userId: userId,
          payType: "CARD"
        }),
        success: function(data) {
            if (data==1) {
              alert('ì¹´ë“œê²°ì œ ì™„ë£Œ');
             // location.href = "result?amount="+rsp.paid_amount
              location.href = "/mypage?tab=schedule";
            } else {
              alert('ê²€ì¦ ì‹¤íŒ¨: ' + data.message);
            }
          },
          error: function(xhr, status, err) {
            console.error('AJAX error', status, err);
            alert('ì„œë²„ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      });
    });
  });
});
</script>

<!-- Footer -->
  <div th:replace="fragments/footer :: footerFragment"></div>

</body>
</html>
